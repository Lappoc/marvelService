{"ast":null,"code":"var _jsxFileName = \"/Users/dasha/Desktop/\\u0437\\u0430\\u0434\\u0430\\u043D\\u0438\\u044F2 \\u043A\\u0443\\u0440\\u0441-3 \\u0441\\u0435\\u043C\\u0435\\u0441\\u0442\\u0440/marvelService-main/src/components/charList/CharList.jsx\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport { CSSTransition, TransitionGroup } from 'react-transition-group';\nimport useMarvelService from '../../services/MarvelService';\nimport Spinner from '../spinner/Spinner';\nimport ErrorMessage from '../errorMessage/ErrorMessage';\nimport './charList.scss';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst CharList = props => {\n  _s();\n\n  const [charList, setCharList] = useState([]);\n  const [newItemLoading, setnewItemLoading] = useState(false);\n  const [offset, setOffset] = useState(210);\n  const [charEnded, setCharEnded] = useState(false);\n  const {\n    loading,\n    error,\n    getAllCharacters\n  } = useMarvelService();\n  useEffect(() => {\n    onRequest(offset, true);\n  }, []);\n\n  const onRequest = (offset, initial) => {\n    initial ? setnewItemLoading(false) : setnewItemLoading(true);\n    getAllCharacters(offset).then(onCharListLoaded);\n  };\n\n  const onCharListLoaded = async newCharList => {\n    let ended = false;\n\n    if (newCharList.length < 9) {\n      ended = true;\n    }\n\n    setCharList([...charList, ...newCharList]);\n    setnewItemLoading(false);\n    setOffset(offset + 9);\n    setCharEnded(ended);\n  };\n\n  const itemRefs = useRef([]);\n\n  const focusOnItem = id => {\n    itemRefs.current.forEach(item => item.classList.remove('char__item_selected'));\n    itemRefs.current[id].classList.add('char__item_selected');\n    itemRefs.current[id].focus();\n  };\n\n  function renderItems(arr) {\n    const items = arr.map((item, i) => {\n      let imgStyle = {\n        'objectFit': 'cover'\n      };\n\n      if (item.thumbnail === 'http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg') {\n        imgStyle = {\n          'objectFit': 'unset'\n        };\n      }\n\n      return /*#__PURE__*/_jsxDEV(CSSTransition, {\n        timeout: 500,\n        classNames: \"char__item\",\n        children: /*#__PURE__*/_jsxDEV(\"li\", {\n          className: \"char__item\",\n          tabIndex: 0,\n          ref: el => itemRefs.current[i] = el,\n          onClick: () => {\n            props.onCharSelected(item.id);\n            focusOnItem(i);\n          },\n          onKeyPress: e => {\n            if (e.key === ' ' || e.key === \"Enter\") {\n              props.onCharSelected(item.id);\n              focusOnItem(i);\n            }\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: item.thumbnail,\n            alt: item.name,\n            style: imgStyle\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 72,\n            columnNumber: 8\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"char__name\",\n            children: item.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 8\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 6\n        }, this)\n      }, item.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 5\n      }, this);\n    });\n    return /*#__PURE__*/_jsxDEV(\"ul\", {\n      className: \"char__grid\",\n      children: /*#__PURE__*/_jsxDEV(TransitionGroup, {\n        component: null,\n        children: items\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 4\n    }, this);\n  }\n\n  const items = renderItems(charList);\n  const errorMessage = error ? /*#__PURE__*/_jsxDEV(ErrorMessage, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 31\n  }, this) : null;\n  const spinner = loading && !newItemLoading ? /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 91,\n    columnNumber: 47\n  }, this) : null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"char__list\",\n    children: [errorMessage, spinner, items, /*#__PURE__*/_jsxDEV(\"button\", {\n      disabled: newItemLoading,\n      style: {\n        'display': charEnded ? 'none' : 'block'\n      },\n      className: \"button button__main button__long\",\n      onClick: () => onRequest(offset),\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"inner\",\n        children: \"load more\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 5\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 4\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 3\n  }, this);\n};\n\n_s(CharList, \"SGmBMfxPW45U4Y8dGu7NmnM0DQk=\", false, function () {\n  return [useMarvelService];\n});\n\n_c = CharList;\nCharList.propTypes = {\n  onCharSelected: PropTypes.func.isRequired\n};\nexport default CharList;\n\nvar _c;\n\n$RefreshReg$(_c, \"CharList\");","map":{"version":3,"names":["useState","useEffect","useRef","PropTypes","CSSTransition","TransitionGroup","useMarvelService","Spinner","ErrorMessage","CharList","props","charList","setCharList","newItemLoading","setnewItemLoading","offset","setOffset","charEnded","setCharEnded","loading","error","getAllCharacters","onRequest","initial","then","onCharListLoaded","newCharList","ended","length","itemRefs","focusOnItem","id","current","forEach","item","classList","remove","add","focus","renderItems","arr","items","map","i","imgStyle","thumbnail","el","onCharSelected","e","key","name","errorMessage","spinner","propTypes","func","isRequired"],"sources":["/Users/dasha/Desktop/задания2 курс-3 семестр/marvelService-main/src/components/charList/CharList.jsx"],"sourcesContent":["import {useState, useEffect, useRef} from 'react';\nimport PropTypes from 'prop-types';\nimport {CSSTransition, TransitionGroup} from 'react-transition-group';\n\nimport useMarvelService from '../../services/MarvelService';\nimport Spinner from '../spinner/Spinner';\nimport ErrorMessage from '../errorMessage/ErrorMessage';\n\nimport './charList.scss';\n\nconst CharList = (props) => {\n\n\tconst [charList, setCharList] = useState([]);\n\tconst [newItemLoading, setnewItemLoading] = useState(false);\n\tconst [offset, setOffset] = useState(210);\n\tconst [charEnded, setCharEnded] = useState(false);\n\t\n\tconst {loading, error, getAllCharacters} = useMarvelService();\n\n\tuseEffect(() => {\n\t\tonRequest(offset, true);\n\t}, [])\n\n\tconst onRequest = (offset, initial) => {\n\t\tinitial ? setnewItemLoading(false) : setnewItemLoading(true);\n\t\tgetAllCharacters(offset)\n\t\t\t.then(onCharListLoaded)\n\t}\n\n\tconst onCharListLoaded = async(newCharList) => {\n\t\tlet ended = false;\n\t\tif (newCharList.length < 9) {\n\t\t\tended = true;\n\t\t}\n\t\tsetCharList([...charList, ...newCharList]);\n\t\tsetnewItemLoading(false);\n\t\tsetOffset(offset + 9);\n\t\tsetCharEnded(ended);\n\t}\n\n\tconst itemRefs = useRef([]);\n\n\tconst focusOnItem = (id) => {\n\t\titemRefs.current.forEach(item => item.classList.remove('char__item_selected'));\n\t\titemRefs.current[id].classList.add('char__item_selected');\n\t\titemRefs.current[id].focus();\n\t}\n\n\tfunction renderItems (arr){\n\t\tconst items =  arr.map((item, i) => {\n\t\t\tlet imgStyle = {'objectFit' : 'cover'};\n\t\t\tif (item.thumbnail === 'http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg') {\n\t\t\t\timgStyle = {'objectFit' : 'unset'};\n\t\t\t}\n\t\t\t\n\t\t\treturn (\n\t\t\t\t<CSSTransition key={item.id} timeout={500} classNames=\"char__item\">\n\t\t\t\t\t<li \n\t\t\t\t\t\tclassName=\"char__item\"\n\t\t\t\t\t\ttabIndex={0}\n\t\t\t\t\t\tref={el => itemRefs.current[i] = el}\n\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\tprops.onCharSelected(item.id);\n\t\t\t\t\t\t\tfocusOnItem(i);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tonKeyPress={(e) => {\n\t\t\t\t\t\t\tif (e.key === ' ' || e.key === \"Enter\") {\n\t\t\t\t\t\t\t\tprops.onCharSelected(item.id);\n\t\t\t\t\t\t\t\tfocusOnItem(i);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}}>\n\t\t\t\t\t\t\t<img src={item.thumbnail} alt={item.name} style={imgStyle}/>\n\t\t\t\t\t\t\t<div className=\"char__name\">{item.name}</div>\n\t\t\t\t\t</li>\n\t\t\t\t</CSSTransition>\n\t\t\t)\n\t\t});\n\n\t\treturn (\n\t\t\t<ul className=\"char__grid\">\n\t\t\t\t<TransitionGroup component={null}>\n\t\t\t\t\t{items}\n\t\t\t\t</TransitionGroup>\n\t\t\t</ul>\n\t\t)\n\t}\n\t\n\tconst items = renderItems(charList);\n\n\tconst errorMessage = error ? <ErrorMessage/> : null;\n\tconst spinner = loading && !newItemLoading ? <Spinner/> : null;\n\n\treturn (\n\t\t<div className=\"char__list\">\n\t\t\t{errorMessage}\n\t\t\t{spinner}\n\t\t\t{items}\n\t\t\t<button \n\t\t\t\tdisabled={newItemLoading} \n\t\t\t\tstyle={{'display' : charEnded ? 'none' : 'block'}}\n\t\t\t\tclassName=\"button button__main button__long\"\n\t\t\t\tonClick={() => onRequest(offset)}>\n\t\t\t\t<div className=\"inner\">load more</div>\n\t\t\t</button>\n\t\t</div>\n\t)\n}\n\nCharList.propTypes = {\n\tonCharSelected: PropTypes.func.isRequired\n}\n\nexport default CharList;"],"mappings":"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"},"metadata":{},"sourceType":"module"}